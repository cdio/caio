#
# MOS6510 CPU test suite.
#
# If a test fails the emulator is halted with exit code 0.
# If all tests succeed the emulator is terminated with exit code 1.
#
########################################
# Clear registers
########################################
a 5000
a9 00
a0 00
a2 00
48
28
.
b 5008


########################################
# CMP ($zp, X) - C1
########################################
#
# lda #$50
# sta $0044
# lda #$00
# sta $0045
# lda #$ff
# sta $0050
# ldx #$04
# lda #$ff
# cmp ($40, x)
#
a 4000
ea
a9 50
8d 44 00
a9 00
8d 45 00
a9 ff
8d 50 00
a2 04
a9 ff
c1 40
ea
02
.
b 4016 ra == #$ff
b 4017 rp == #$23
g 5000
g 4000
g .
bd 4016
bd 4017


########################################
# CMP $zp - C5
########################################
#
# lda #$ff
# sta $0050
# lda #$00
# cmp $50
#
a 4000
ea
a9 ff
8d 50 00
a9 00
c5 50
02
.
b 400a rp == #$20
g 5000
g 4000
bd 400a


########################################
# CMP #$imm - C9
########################################
#
# lda #$ff
# cmp #$00
#
a 4000
ea
a9 ff
c9 00
02
.
b 4005 rp == #$a1
g 5000
g 4000
bd 4005


########################################
# CMP $abs - CD
########################################
#
# See CMP $zp
#
# lda +10
# sta $0045
# lda -126      ;#$82
# cmp $0045
#
a 4000
ea
a9 0a
8d 45 00
a9 82
cd 45 00
ea
02
.
b 400b ra == #$82
b 400c rp == #$21
g 5000
g 4000
g .
bd 400b
bd 400c


########################################
# CMP ($zp), Y - D1
########################################
#
# lda #$02
# sta $004f
# lda #$50
# sta $0044
# lda #$00
# sta $0045
# ldy #$01
# lda #$ff
# cmp ($44), y
#
a 4000
ea
a9 02
8d 50 00
a9 4f
8d 44 00
a9 00
8d 45 00
a0 01
a9 ff
d1 44
02
.
b 4016 rp == #$a1
g 5000
g 4000
bd 4016


########################################
# CMP $zp, X - D5
########################################
#
# lda #$05
# sta $0054
# ldx #$04
# lda #$05
# cmp $50, x
#
a 4000
ea
a9 05
8d 54 00
a2 04
a9 05
d5 50
02
.
b 400c rp == #$23
g 5000
g 4000
bd 400c


########################################
# CMP $abs, Y - D9
########################################
#
# lda #$00
# sta $0054
# ldy #$04
# sec
# lda #$ff
# cmp $0050, y
#
a 4000
ea
a9 00
8d 54 00
a0 04
a9 ff
d9 50 00
02
.
b 400d rp == #$a1
g 5000
g 4000
bd 400d


########################################
# CMP $abs, X - DD
########################################
#
# lda #$05
# sta $0054
# ldx #$04
# lda #$05
# cmp $0050, x
#
a 4000
ea
a9 05
8d 54 00
a2 04
dd 50 00
02
.
b 400b rp == #$23
g 5000
g 4000
bd 400b


########################################
# CPX #$imm - E0
########################################
#
# ldx -1
# cpx -1
#
a 4000
ea
a2 ff
e0 ff
02
.
b 4005 rp == #$23
g 5000
g 4000
bd 4005


########################################
# CPX $zp - E4
########################################
#
# lda #$ff
# sta $0050
# ldx #$00
# cpx $50
#
a 4000
ea
a9 ff
8d 50 00
a2 00
e4 50
02
.
b 400a rp == #$20
g 5000
g 4000
bd 400a


########################################
# CPX $abs - EC
########################################
#
# lda #$ff
# sta $0050
# ldx #$ff
# cpx $0050
#
a 4000
ea
a9 ff
8d 50 00
a2 ff
ec 50 00
02
.
b 400b rp == #$23
g 5000
g 4000
bd 400b


########################################
# CPY #$imm - C0
########################################
#
# ldy -1
# cpy -1
#
a 4000
ea
a0 ff
c0 ff
02
.
b 4005 rp == #$23
g 5000
g 4000
bd 4005


########################################
# CPY $zp - C4
########################################
#
# lda #$ff
# sta $0050
# ldy #$00
# cpy $50
#
a 4000
ea
a9 ff
8d 50 00
a0 00
c4 50
02
.
b 400a rp == #$20
g 5000
g 4000
bd 400a


########################################
# CPY $abs - CC
########################################
#
# lda #$ff
# sta $0050
# ldy #$ff
# cpy $0050
#
a 4000
ea
a9 ff
8d 50 00
a0 ff
cc 50 00
02
.
b 400b rp == #$23
g 5000
g 4000
bd 400b


#
# Success
#
quit 1