#
# MOS6510 CPU test suite.
#
# If a test fails the emulator is halted with exit code 0.
# If all tests succeed the emulator is terminated with exit code 1.
#
########################################
# Clean registers
########################################
a 5000
a9 00
a0 00
a2 00
48
28
.
b 5008


########################################
# LDA ($zp, X) - A1
########################################
#
# lda #$50
# sta $44
# lda #$00
# sta $45
# lda #$ba
# sta $50
# ldx #$04
# lda #$00
# lda ($40, x)
#
a 4000
ea
a9 50
85 44
a9 00
85 45
a9 ba
85 50
a2 04
a9 00
a1 40
02
.
b 4011 ra == #$00
b 4013 ra == #$ba
g 5000
g 4000
g .
bd 4011
bd 4013


########################################
# LDA $zp - A5
########################################
#
# lda #$55
# sta $45
# lda #$ff
# lda $45
#
a 4000
ea
a9 55
85 45
a9 ff
a5 45
02
.
b 4007 ra == #$ff
b 4009 ra == #$55
g 5000
g 4000
g .
bd 4007
bd 4009


########################################
# LDA immediate - A9
########################################
#
# lda #$ff
#
a 4000
ea
a9 ff
ea
a9 00
ea
02
.
b 4003 ra == #$ff
b 4004 rp == #$a0
b 4006 ra == #$00
b 4007 rp == #$22
g 5000
g 4000
g .
g .
g .
bd 4003
bd 4004
bd 4006
bd 4007


########################################
# LDA $abs - AD
########################################
#
# lda #$ba
# sta $45
# lda #$ff
# lda $0045
#
a 4000
ea
a9 ba
85 45
a9 ff
ad 45 00
02
.
b 4007 ra == #$ff
b 400a ra == #$ba
g 5000
g 4000
g .
bd 4007
bd 400a


########################################
# LDA ($zp), Y - B1
########################################
#
# lda #$4c
# sta $0044
# lda #$00
# sta $0045
# lda #$ba
# sta $0050
# ldy #$04
# lda #$ff
# lda ($44), y
#
a 4000
ea
a9 4c
8d 44 00
a9 00
8d 45 00
a9 ba
8d 50 00
a0 04
a9 ff
b1 44
02
.
b 4016 ra == #$ba
g 5000
g 4000
bd 4016


########################################
# LDA $zp, X - B5
########################################
#
# lda #$ba
# sta $45
# lda #$ff
# lda $45, x
#
a 4000
ea
a9 ba
85 45
a9 ff
a2 05
b5 40
02
.
b 400b ra == #$ba
g 5000
g 4000
bd 400b


########################################
# LDA $abs, Y - B9
########################################
#
# lda #$ba
# sta $0045
# lda #$7f
# ldy #$05
# lda $0040, Y
#
a 4000
ea
a9 ba
8d 45 00
a9 7f
a0 05
b9 40 00
02
.
b 400d ra == #$ba
g 5000
g 4000
bd 400d


########################################
# LDA $abs, X - BD
########################################
#
# lda #$ba
# sta $0045
# lda #$ff
# ldx #$05
# lda $0040, X
#
a 4000
ea
a9 ba
8d 45 00
a9 ff
a2 05
bd 40 00
02
.
b 400d ra == #$ba
g 5000
g 4000
bd 400d


########################################
# LDX immediate - A2
########################################
#
# ldx #$ff
#
a 4000
ea
a2 ff
ea
a2 00
ea
02
.
b 4003 rx == #$ff
b 4004 rp == #$a0
b 4006 rx == #$00
b 4007 rp == #$22
g 5000
g 4000
g .
g .
g .
bd 4003
bd 4004
bd 4006
bd 4007


########################################
# LDX $zp - A6
########################################
#
# lda #$55
# sta $45
# ldx $45
#
a 4000
ea
a9 55
85 45
a6 45
02
.
b 4007 rx == #$55
g 5000
g 4000
bd 4007


########################################
# LDX $abs - AE
########################################
#
# lda #$55
# sta $6045
# ldx $6045
#
a 4000
ea
a9 55
8d 45 60
ae 45 60
02
.
b 4009 rx == #$55
g 5000
g 4000
bd 4009


########################################
# LDX $zp, Y - B6
########################################
#
# lda #$ba
# sta $45
# ldy #$05
# ldx $40, y
#
a 4000
ea
a9 ba
85 45
a0 05
b6 40
02
.
b 4009 rx == #$ba
g 5000
g 4000
bd 4009


########################################
# LDX $abs, Y - BE
########################################
#
# lda #$ba
# sta $6045
# ldy #$05
# ldx $6040, y
#
a 4000
ea
a9 f0
8d 45 60
a0 05
be 40 60
02
.
b 400b rx == #$f0
g 5000
g 4000
bd 400b


########################################
# LDY immediate - A0
########################################
#
# ldy #$ff
#
a 4000
ea
a0 ff
ea
a0 00
ea
02
.
b 4003 ry == #$ff
b 4004 rp == #$a0
b 4006 ry == #$00
b 4007 rp == #$22
g 5000
g 4000
g .
g .
g .
bd 4003
bd 4004
bd 4006
bd 4007


########################################
# LDY $zp - A4
########################################
#
# lda #$55
# sta $45
# ldy $45
#
a 4000
ea
a9 55
85 45
a4 45
02
.
b 4007 ry == #$55
g 5000
g 4000
bd 4007


########################################
# LDY $abs - AC
########################################
#
# lda #$55
# sta $6045
# ldy $6045
#
a 4000
ea
a9 55
8d 45 60
ac 45 60
02
.
b 4009 ry == #$55
g 5000
g 4000
bd 4009


########################################
# LDY $zp, X - B4
########################################
#
# lda #$ba
# sta $45
# ldx #$05
# ldy $40, x
#
a 4000
ea
a9 ba
85 45
a2 05
b4 40
02
.
b 4009 ry == #$ba
g 5000
g 4000
bd 4009


########################################
# LDY $abs, X   - BC
# STA $abs      - 8D
########################################
#
# lda #$ba
# sta $6045
# ldx #$05
# ldy $6040, x
#
a 4000
ea
a9 f0
8d 45 60
a2 05
bc 40 60
02
.
b 400b ry == #$f0
g 5000
g 4000
bd 400b


########################################
# STA ($zp, X)  - 81
# STA $zp       - 85
########################################
#
# lda #$50
# sta $45
# lda #$00
# sta $46
# lda #$fb
# ldx #$05
# sta ($40, x)
# lda #$00
# ldy $50
#
a 4000
ea
a9 50
85 45
a9 00
85 46
a9 fb
a2 05
81 40
a9 00
a4 50
ea
02
.
b 4013 ry == #$fb
b 4014 rp == #$a0
g 5000
g 4000
g .
bd 4013
bd 4014


########################################
# STA ($zp), Y  - 91
########################################
#
# lda #$05
# sta $45
# lda #$00
# sta $46
# lda #$fb
# ldy #$50
# sta ($45), y
# lda #$00
# ldx $55
#
a 4000
ea
a9 05
85 45
a9 00
85 46
a9 fb
a0 50
91 45
a9 00
a6 55
ea
02
.
b 4013 rx == #$fb
b 4014 rp == #$a0
g 5000
g 4000
g .
bd 4013
bd 4014


########################################
# STA $zp, X    - 95
########################################
#
# lda #$05
# ldx #$40
# sta $02, x
# ldy $40
#
a 4000
ea
a9 05
a2 40
95 02
a4 42
02
.
b 4009 ry == #$05
g 5000
g 4000
bd 4009


########################################
# STA $abs, Y    - 99
########################################
#
# lda #$05
# ldy #$3e
# sta $6002, y
# ldx $6040
#
a 4000
ea
a9 05
a0 3e
99 02 60
ae 40 60
02
.
b 4008 rp == #$20
b 400b rx == #$05
g 5000
g 4000
g .
bd 4008
bd 400b


########################################
# STA $abs, X    - 9D
########################################
#
# lda #$05
# ldx #$3e
# sta $6002, x
# ldy $6040
#
a 4000
ea
a9 05
a2 3e
9d 02 60
ac 40 60
02
.
b 4008 rp == #$20
b 400b ry == #$05
g 5000
g 4000
g .
bd 4008
bd 400b


########################################
# STX $zp       - 86
########################################
#
# ldx #$ff
# stx $50
# lda $50
#
a 4000
ea
a2 ff
86 50
a5 50
02
.
b 4007 ra == #$ff
g 5000
g 4000
bd 4007


########################################
# STX $abs      - 8E
########################################
#
# ldx #$ff
# stx $6050
# lda $6050
#
a 4000
ea
a2 ff
8e 50 60
ad 50 60
02
.
b 4009 ra == #$ff
g 5000
g 4000
bd 4009


########################################
# STX $zp, Y    - 96
########################################
#
# ldy #$40
# ldx #$ff
# stx $00, y
# lda $40
#
a 4000
ea
a0 40
a2 ff
96 00
a5 40
02
.
b 4009 ra == #$ff
g 5000
g 4000
bd 4009


########################################
# STY $zp       - 84
########################################
#
# ldy #$ff
# sty $50
# lda $50
#
a 4000
ea
a0 ff
84 50
a5 50
02
.
b 4007 ra == #$ff
g 5000
g 4000
bd 4007


########################################
# STY $abs      - 8C
########################################
#
# ldy #$ff
# sty $6050
# lda $6050
#
a 4000
ea
a0 ff
8c 50 60
ad 50 60
02
.
b 4009 ra == #$ff
g 5000
g 4000
bd 4009


########################################
# STY $zp, X    - 94
########################################
#
# ldx #$40
# ldy #$ff
# sty $00, x
# lda $40
#
a 4000
ea
a0 af
a2 40
94 01
a5 41
02
.
b 4009 ra == #$af
g 5000
g 4000
bd 4009


########################################
# TAX           - AA
########################################
#
# lda #ff
# ldx #01
# tax
#
a 4000
ea
a9 ff
a2 01
aa
ea
02
.
b 4005 rp == #$20
b 4006 rp == #$a0
b 4007 rx == #$ff
g 5000
g 4000
g .
bd 4005
bd 4006
bd 4007


########################################
# TXA           - 8A
########################################
#
# ldx #ff
# lda #01
# txa
#
a 4000
ea
a2 ff
a9 01
8a
ea
02
.
b 4005 rp == #$20
b 4006 rp == #$a0
b 4007 ra == #$ff
g 5000
g 4000
g .
bd 4005
bd 4006
bd 4007


########################################
# TAY           - A8
########################################
#
# lda #ff
# ldy #01
# tay
#
a 4000
ea
a9 ff
a0 01
a8
ea
02
.
b 4005 rp == #$20
b 4006 rp == #$a0
b 4007 ry == #$ff
g 5000
g 4000
g .
bd 4005
bd 4006
bd 4007


########################################
# TYA           - 98
########################################
#
# ldy #ff
# lda #01
# tya
#
a 4000
ea
a0 ff
a9 01
98
ea
02
.
b 4005 rp == #$20
b 4006 rp == #$a0
b 4007 ra == #$ff
g 5000
g 4000
g .
bd 4005
bd 4006
bd 4007


########################################
# TXS           - 9A
# TSX           - BA
########################################
#
# ldx #$ff
# txs
# pha
# tsx
# pla
#
a 4000
ea
a2 ff
9a
48
ba
28
ea
02
.
b 4004 rs == #$ff
b 4005 rs == #$fe
b 4007 rx == #$fe
b 4008 rs == #$ff
g 5000
g 4000
g .
g .
g .
bd 4004
bd 4005
bd 4007
bd 4008


########################################
# PHA           - 48
# PLA           - 68
########################################
#
# ldx #$ff
# txs
# lda #$05
# pha
# lda #$00
# ldx $ff
# pla
#
a 4000
ea
a2 ff
9a
a9 05
48
a9 00
ae ff 01
68
ea
02
.
b 400c rx == #$05
b 400d ra == #$05
b 400e rs == #$ff
g 5000
g 4000
g .
g .
bd 400c
bd 400d
bd 400e


########################################
# PHP           - 08
########################################
#
# lda #$ff
# php
# pla
#
a 4000
ea
a9 ff
08
68
02
.
b 4005 ra == #$a0
g 5000
g 4000
bd 4005


########################################
# PLP           - 28
########################################
#
# lda #$ff
# pha
# plp
#
a 4000
ea
a9 ff
48
28
02
.
b 4005 rp == #$ff
g 5000
g 4000
bd 4005


#
# Success
#
quit 1