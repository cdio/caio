#
# MOS6510 CPU test suite.
#
# If a test fails the emulator is halted with exit code 0.
# If all tests succeed the emulator is terminated with exit code 1.
#
########################################
# Clean registers
########################################
a 5000
a9 00
a0 00
a2 00
.
b 5006


########################################
# AND immediate - 29
########################################
#
# lda #$ff
# and #$ba
#
a 4000
ea
a9 ff
29 ba
02
.
b 4005 ra == #$ba
g 5000
g 4000


########################################
# AND ($zp, X) - 21
########################################
#
# lda #$50
# sta $0044
# lda #$00
# sta $0045
# lda #$ba
# sta $0050
# ldx #$04
# lda #$ff
# and ($40, x)
#
a 4000
ea
a9 50
8d 44 00
a9 00
8d 45 00
a9 ba
8d 50 00
a2 04
a9 ff
21 40
02
.
b 4016 ra == #$ba
g 5000
g 4000
bd 4016


########################################
# AND $zp - 25
########################################
#
# lda #$ba
# sta $0045
# lda #$ff
# and $45
#
a 4000
ea
a9 ba
8d 45 00
a9 ff
25 45
02
.
b 400a ra == #$ba
g 5000
g 4000
bd 400a


########################################
# AND $abs - 2D
########################################
#
# lda #$ba
# sta $0045
# lda #$ff
# and $0045
#
a 4000
ea
a9 ba
8d 45 00
a9 7f
2d 45 00
02
.
b 400b ra == #$3a
g 5000
g 4000
bd 400b


########################################
# AND ($zp), Y - 31
########################################
#
# lda #$4c
# sta $0044
# lda #$00
# sta $0045
# lda #$ba
# sta $0050
# ldy #$04
# lda #$ff
# and ($44), y
#
a 4000
ea
a9 4c
8d 44 00
a9 00
8d 45 00
a9 ba
8d 50 00
a0 04
a9 ff
31 44
02
.
b 4016 ra == #$ba
g 5000
g 4000
bd 4016


########################################
# AND $zp, X - 35
########################################
#
# lda #$ba
# sta $0045
# lda #$ff
# and $45
#
a 4000
ea
a9 ba
8d 45 00
a9 ff
a2 05
35 40
02
.
b 400c ra == #$ba
g 5000
g 4000
bd 400c


########################################
# AND $abs, Y - 39
########################################
#
# lda #$ba
# sta $0045
# lda #$ff
# ldy #$05
# and $0040, Y
#
a 4000
ea
a9 ba
8d 45 00
a9 7f
a0 05
39 40 00
02
.
b 400d ra == #$3a
g 5000
g 4000
bd 400d


########################################
# AND $abs, X - 3D
########################################
#
# lda #$ba
# sta $0045
# lda #$ff
# ldx #$05
# and $0040, X
#
a 4000
ea
a9 ba
8d 45 00
a9 7f
a2 05
3d 40 00
02
.
b 400d ra == #$3a
g 5000
g 4000
bd 400d


#
# Success
#
quit 1